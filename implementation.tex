%!TEX root = 2024-cmsb_tool.tex
\ToolName is an open source python library. 
It uses \texttt{Scipy, Numpy} for numerical calculations, while \texttt{sympy} for exact symbolic ones.
The architecture of \ToolName is shown in Figure~\ref{fig:clue_arch}.
The functionalities can be grouped in three sets: the I/O modules, the core modules and the utilities modules.
%Explain the software architecture of the project 
\input{clue_arch.tex}
\subsection{Model I/O}
\ToolName supports local models either written using \texttt{sympy}, as ERODE \texttt{.ode} files or they can be pulled directly from the OdeBase repository. 
Systems of ODEs written in sympy can be directly instantiated as CLUE objects.
Models from the OdeBase repository are directly converted into CLUE objects using the functionality of the \texttt{odebase\_io.py} module.
Finally \texttt{.ode} are translated to CLUE objects via \texttt{ode\_parser.py}.
Additional utilities used when parsing rational systems are stored in \texttt{rational\_function.py}.

\subsection{Core functionalities}
The core functionalities of \ToolName are stored in the modules \texttt{linalg.py} and \texttt{clue.py}

\subsubsection{Linear Algebra.}
All linear algebraic operations are done using \texttt{SparseVectors} which are hash tables storing as keys the number of the nonzero value and as values the actual values of the vector. 
For example the vector $(0,0,0,1,0,0,2,0,5,0)$ is stored as the hash table $\{ 3:1, 6:2, 9:5\}$.
Similarly, matrices are stored as hash tables where the keys are the nonzero rows and the values are \texttt{SpareseVectors} representing the actual row.
All lumpings are computing by finding an invariant subspace. 
These can be \texttt{Subspace} or \texttt{NumericalSubspace} for exact and approximate lumpings, respectively.
Given an exact lumping $L$, \texttt{Subspace} computes the space generated by the rows of $L$ via Gaussian elimination, while \texttt{NumericalSubspace} does it by using orthogonal projections.

\subsubsection{Constrained Lumping}
The main module of \ToolName is \texttt{clue.py}.
In this module, the main object is the \texttt{FODEsystem} which contains all the information related to a model. 
This means the dynamics, parameters, observables and initial conditions.
It includes functionality to compute both exact and approximate lumpings for systems of Polynomial and Rational ODEs.
As well as to export systems as \texttt{.ode} files.
The class \texttt{LDESystem} extends the \texttt{FODEsystem} class to store lumpings. 
It stores the lumping as a \texttt{Subspace} and has extra functionality such as storing the old system for ease of use. 


\subsection{Simulation and output}
The last set of functionalities is in the \texttt{simulations.py} module.
This is a simple interface to \texttt{scipy} and \texttt{matplotlib} made to quickly run and plot simulations. 
It allows the simple data manipulation and output of plots and formatted tables for simulation results.

